!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("Phaser")):"function"==typeof define&&define.amd?define("Game",["Phaser"],t):"object"==typeof exports?exports.Game=t(require("Phaser")):e.Game=t(e.Phaser)}("undefined"!=typeof self?self:this,(function(e){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(s,a,function(t){return e[t]}.bind(null,a));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="http://localhost:3200/",r(r.s=2)}([function(t,r){t.exports=e},function(e,t){var r=/\{([0-9a-zA-Z]+)\}/g,s=Array.prototype.slice;e.exports=function(e){var t;t=2===arguments.length&&"object"==typeof arguments[1]?arguments[1]:s.call(arguments,1);t&&t.hasOwnProperty||(t={});return e.replace(r,(function(r,s,a){var o;return"{"===e[a-1]&&"}"===e[a+r.length]?s:null==(o=t.hasOwnProperty(s)?t[s]:null)?"":o}))}},function(e,t,r){"use strict";r.r(t);var s={};r.r(s),r.d(s,"fireballSpell",(function(){return P})),r.d(s,"hellfireSpell",(function(){return v})),r.d(s,"frostShardSpell",(function(){return T})),r.d(s,"teleportSpell",(function(){return S})),r.d(s,"teleportGate",(function(){return I})),r.d(s,"bullet",(function(){return B})),r.d(s,"hellfireTube",(function(){return M})),r.d(s,"frostShard",(function(){return k}));var a={};r.r(a),r.d(a,"monsterController",(function(){return E}));var o={};r.r(o),r.d(o,"player",(function(){return D})),r.d(o,"summonGate",(function(){return A})),r.d(o,"monster",(function(){return R})),r.d(o,"monsterBoomer",(function(){return L})),r.d(o,"monsterBoss",(function(){return W})),r.d(o,"monsterBoss2",(function(){return G})),r.d(o,"heart",(function(){return K})),r.d(o,"powerup",(function(){return N}));var n={};r.r(n),r.d(n,"mbullet",(function(){return Z})),r.d(n,"mbullet2",(function(){return F})),r.d(n,"blood",(function(){return H})),r.d(n,"bloodSpray",(function(){return _})),r.d(n,"explosion",(function(){return U})),r.d(n,"monsterExplosion",(function(){return X})),r.d(n,"fog",(function(){return Y}));var i={};r.r(i),r.d(i,"tree1",(function(){return V})),r.d(i,"tree2",(function(){return q})),r.d(i,"stones",(function(){return J}));var l={};r.r(l),r.d(l,"cursor",(function(){return Q})),r.d(l,"counter",(function(){return $})),r.d(l,"leftOnWaveLabel",(function(){return ee})),r.d(l,"level",(function(){return te})),r.d(l,"timer",(function(){return re})),r.d(l,"bestTime",(function(){return se})),r.d(l,"bestScore",(function(){return ae}));var p={};r.r(p),r.d(p,"fireball",(function(){return ie})),r.d(p,"hellfire",(function(){return le})),r.d(p,"slowEnemies",(function(){return pe})),r.d(p,"teleport",(function(){return de})),r.d(p,"frostShard",(function(){return ce})),r.d(p,"bulletMonsterCollision",(function(){return me})),r.d(p,"hellTubeMonsterCollision",(function(){return ue}));var d={};r.r(d),r.d(d,"monsterController",(function(){return ge}));var c={};r.r(c),r.d(c,"playerDeath",(function(){return be})),r.d(c,"damageOnPlayerCollision",(function(){return we})),r.d(c,"destroyOnPlayerCollision",(function(){return xe})),r.d(c,"triggerOnPlayerCollision",(function(){return Oe})),r.d(c,"meleeAttack",(function(){return Ce})),r.d(c,"monsterExplosion",(function(){return je})),r.d(c,"monsterExplosionCondition",(function(){return ze})),r.d(c,"stopOnCollisionWithPlayer",(function(){return Pe})),r.d(c,"resetSpeed",(function(){return ve})),r.d(c,"resetEffects",(function(){return Te})),r.d(c,"moveToDirection",(function(){return Se})),r.d(c,"playerLevelUp",(function(){return Ie})),r.d(c,"monsterHealthStatus",(function(){return Be})),r.d(c,"resetRangeCooldown",(function(){return Me})),r.d(c,"resetMeleeCooldown",(function(){return ke})),r.d(c,"monsterBossLogic",(function(){return Ee})),r.d(c,"monsterBoss2Logic",(function(){return De})),r.d(c,"monsterBoss2Bullet",(function(){return Ae})),r.d(c,"moveWithKeyboard",(function(){return Re})),r.d(c,"selectSpellWithKeyboard",(function(){return Le})),r.d(c,"triggerOnPlayerCollisionPowerUp",(function(){return We})),r.d(c,"summonOnCooldown",(function(){return Ge}));var m={};r.r(m),r.d(m,"randomTrees",(function(){return Ke})),r.d(m,"spawnHeart",(function(){return Ne})),r.d(m,"spawnPowerup",(function(){return Ze})),r.d(m,"spawnTerrain",(function(){return Fe})),r.d(m,"goWithPlayer",(function(){return He}));var u={};r.r(u),r.d(u,"countMonsterKilled",(function(){return _e})),r.d(u,"timer",(function(){return Ue})),r.d(u,"health",(function(){return Xe})),r.d(u,"level",(function(){return Ye})),r.d(u,"bestTime",(function(){return Ve})),r.d(u,"bestScore",(function(){return qe}));var h={};r.r(h),r.d(h,"bindPositionToLayer",(function(){return Je})),r.d(h,"destroyAfterLeavingLayer",(function(){return Qe})),r.d(h,"setDirectionToPlayer",(function(){return $e})),r.d(h,"setDirectionToPlayerAdvance",(function(){return et})),r.d(h,"wandererAI",(function(){return tt})),r.d(h,"dynamicZIndex",(function(){return rt})),r.d(h,"collisions",(function(){return st})),r.d(h,"rotateToMouse",(function(){return at})),r.d(h,"bindPositionToMouse",(function(){return ot})),r.d(h,"removeOnCooldown",(function(){return nt})),r.d(h,"explosionOnCooldown",(function(){return it})),r.d(h,"explosionAfterSpriteDone",(function(){return lt})),r.d(h,"destroyAfterSpriteDone",(function(){return pt})),r.d(h,"rotateByDirection",(function(){return dt})),r.d(h,"rotateByPlayer",(function(){return ct}));var f=r(0),y=r.n(f);class g extends y.a.State{preload(){this.game.stage.backgroundColor=921102,this.game.load.image("loading","../assets/img/loading.png")}create(){this.game.state.start("loading")}}var b=g;class w extends y.a.State{preload(){this.game.stage.backgroundColor=921102,this.text=this.add.text(460,250,"LOADING",{fill:"#efefef"}),this.game.load.setPreloadSprite(this.game.add.image(400,300,"loading")),this.game.load.spritesheet("button","../assets/img/buttons.png",293,54),this.game.load.image("mainmenu","../assets/img/mainmenu.jpeg"),this.game.load.image("deathmenu","../assets/img/deathbackground.jpg"),this.game.load.image("bigMonsters","../assets/img/bigMonsters.png"),this.game.load.image("boss","../assets/img/boss.png"),this.game.load.image("bossSpell","../assets/img/bossSpell.png"),this.game.load.image("monsterBlood","../assets/img/sblood.png"),this.game.load.image("bloodEffect","../assets/img/bloods.png"),this.game.load.image("cursor","../assets/img/cursor.png"),this.game.load.image("darkblast","../assets/img/darkblast.png"),this.game.load.image("demons","../assets/img/demons.png"),this.game.load.image("effects","../assets/img/effects.png"),this.game.load.image("explosions","../assets/img/explosions.png"),this.game.load.image("fireball","../assets/img/fireballsprite.png"),this.game.load.image("hellfire","../assets/img/hellfire.png"),this.game.load.image("frostEffect","../assets/img/frosteffect.png"),this.game.load.image("pumpkin","../assets/img/heart.png"),this.game.load.image("hero","../assets/img/mainhero.png"),this.game.load.image("powerUp","../assets/img/powerup2.png"),this.game.load.image("arcaneGate","../assets/img/spell.png"),this.game.load.image("spellIcons","../assets/img/spellicons.png"),this.game.load.image("stone","../assets/img/stones.png"),this.game.load.image("terrain","../assets/img/terrain.png"),this.game.load.image("tree1","../assets/img/tree1.png"),this.game.load.image("tree2","../assets/img/tree2.png"),this.game.load.audio("menuTheme","../assets/music/menu.mp3"),this.game.load.audio("deathTheme","../assets/music/death.mp3"),this.game.load.audio("battleTheme","../assets/music/battle.mp3")}create(){this.text.destroy(),this.game.state.start("mainMenu")}}var x=w;class O extends y.a.State{init(){this.menuTheme=this.sound.add("menuTheme",.3,!0),this.background=this.game.add.image(512,768,"mainmenu"),this.background.anchor.set(.5,1),this.background.alpha=.8}create(){this.generateControls(),this.menuTheme.play()}generateControls(){const e=this.add.button(512,384,"button",this.startGame,this,2,0,1,2),t=this.add.text(0,3,"START",{fill:"#efefef"}),r=this.add.text(-300,-300," MOVING: WASD\n AIM: MOUSE\n CAST SPELL: MOUSE CLICK OR SPACE\n SELECT SPELL: 1, 2, 3.",{fontSize:"20px",fill:"#efefef"});t.anchor.setTo(.5,.5),r.anchor.setTo(.5,.5),e.anchor.setTo(.5,.5),e.addChild(t),e.addChild(r)}startGame(){this.game.state.start("battle")}shutdown(){this.menuTheme.stop()}}var C=O;var j=function(e){const t=e.n||6,r=e.width||800,s=e.height||600,a=r>>t,o=s>>t,n=new Array(a*o);function i(){for(let e=0;e<n.length;e++)n[e]=[]}function l(e){return e[0]+e[1]*o}function p(e,t,r,s){return a=e.x+t[0]/2,o=e.y+t[1]/2,n=e.x-t[0]/2,i=e.y-t[1]/2,l=r.x+s[0]/2,p=r.y+s[1]/2,d=r.x-s[0]/2,c=r.y-s[1]/2,!(n>=l||a<d||i>=p||o<c);var a,o,n,i,l,p,d,c}return i(),{cellGrid:n,updateObject:function(e){const r=function(e){const r=e.pos,s=e.size,a=[],o=s[0]>>t,n=s[1]>>t;for(let e=0;e<2+o;e++)for(let i=0;i<2+n;i++)a.push(l([r.x-s[0]/2+e*(s[0]/(1+o))>>t,r.y-s[1]/2+i*(s[1]/(1+n))>>t]));return a}(e),s=e.parameters.collisions.cells;for(let t=0;t<r.length;t++)s[t]!==r[t]?(n[s[t]]&&n[s[t]].splice(n[s[t]].indexOf(e),1),n[r[t]]&&-1===n[r[t]].indexOf(e)&&n[r[t]].push(e),s[t]=r[t]):n[r[t]]&&-1===n[r[t]].indexOf(e)&&n[r[t]].push(e)},removeObject:function(e){const t=e.parameters.collisions.cells;for(let r=0;r<t.length;r++)n[t[r]]&&n[t[r]].splice(n[t[r]].indexOf(e),1)},check:function(){for(let e=0;e<=a;e++)for(let t=0;t<=o;t++)if(n[l([e,t])]){const r=n[l([e,t])],s=r.length;for(let e=0;e<s;e++)for(let t=e+1;t<s;t++)p(r[e].pos,r[e].size,r[t].pos,r[t].size)&&(-1===r[e].parameters.collisions.indexOf(r[t])&&r[e].parameters.collisions.push(r[t]),-1===r[t].parameters.collisions.indexOf(r[e])&&r[t].parameters.collisions.push(r[e]))}},clear:i}};const z=e=>Object.assign({},e),P={zIndex:5e3,sprite:["spellIcons",[0,0],[32,32]],pos:[449,748],size:[32,32],render:"spell",parameters:{bulletsFired:0,cooldown:20},type:"spell",rules:["fireball"]},v={zIndex:5e3,sprite:["spellIcons",[96,0],[32,32]],pos:[491,748],size:[32,32],render:"spell",parameters:{bulletsFired:0,cooldown:800},type:"spell",rules:["hellfire"]},T={zIndex:5e3,sprite:["spellIcons",[224,96],[32,32]],pos:[533,748],size:[32,32],render:"spell",parameters:{shardsFired:0,cooldown:500},type:"spell",rules:["frostShard"]},S={zIndex:5e3,sprite:["spellIcons",[64,32],[32,32]],pos:[575,748],size:[32,32],render:"spell",parameters:{power:200,teleportGates:0,cooldown:200},type:"spell",rules:["teleport"]},I={zIndex:0,render:"object",sprite:["arcaneGate",[0,0],[32,32],7,[0,1]],pos:[466,580],size:[32,32],parameters:{cooldown:200},type:"spellElement",rules:["removeOnCooldown","dynamicZIndex"]},B={zIndex:3,collisions:!0,render:"object",sprite:["fireball",[0,0],[33,33],16,[0,1,2,3]],size:[25,25],type:"spellElement",parameters:{power:10,cooldown:100,speed:300},conditions:["bulletMonsterCollision"],rules:["destroyAfterLeavingLayer","moveToDirection","dynamicZIndex","explosionOnCooldown"]},M={zIndex:3,collisions:!0,render:"object",sprite:["hellfire",[0,0],[21,58],14,[2,3,4,4,3,2,2,3,4,4,3,2,2,3,4,4,3,2],null,!1],size:[50,50],type:"spellElement",parameters:{power:10,cooldown:150,speed:300},conditions:["hellTubeMonsterCollision"],rules:["dynamicZIndex","explosionOnCooldown"]},k={zIndex:3,render:"object",collisions:!0,sprite:["effects",[96,0],[32,32],10,[0,1,2]],type:"spellElement",size:[500,500],parameters:{power:60,cooldown:200},conditions:["slowEnemies"],rules:["removeOnCooldown","dynamicZIndex"]},E={render:!1,collisions:!1,type:"monsterController",rules:["monsterController"],parameters:{monsterCount:[10,25,50,75,100,150,200,500,1e3,2500,5e3,1e4],monsterCooldown:7}},D={zIndex:20,sprite:["hero",[0,0],[32,32],6,[0,1,2]],pos:[662,534],size:[25,32],render:"unit",collisions:!0,parameters:{speed:150,health:50,spellPower:1,level:1,exp:0,effects:[],currentSpell:"fireball",direction:{},levelTable:{1:600,2:1200,3:2e3,4:3e3,5:4500,6:6500,7:9e3,8:13e3,9:2e4}},type:"player",conditions:["selectSpellWithKeyboard"],rules:["moveWithKeyboard","rotateToMouse","bindPositionToLayer","playerDeath","moveToDirection","dynamicZIndex","resetSpeed","resetEffects","playerLevelUp"]},A={zIndex:0,render:"object",sprite:["arcaneGate",[0,0],[32,32],7,[0,1]],pos:[466,580],size:[25,30],collisions:!0,parameters:{cooldown:80,exp:3,chanceOfBoss:5,chanceOfBoss2:8,chanceOfBoomer:20,health:10},conditions:["monsterHealthStatus"],type:"monster",rules:["summonOnCooldown","dynamicZIndex"]},R={zIndex:1,sprite:["demons",[0,128],[32,32],6,[0,1,2]],size:[20,28],collisions:!0,render:"unit",parameters:{speed:25,cooldown:70,scentSpeed:120,scentRange:600,exp:15,wanderCooldown:500,effects:[],health:20,power:5},conditions:["monsterHealthStatus","stopOnCollisionWithPlayer"],type:"monster",rules:["moveToDirection","wandererAI","rotateByDirection","meleeAttack","dynamicZIndex","resetEffects","resetMeleeCooldown"]},L={zIndex:1,sprite:["demons",[96,128],[32,32],6,[0,1,2]],size:[20,28],collisions:!0,render:"unit",parameters:{speed:100,exp:30,effects:[],health:10,power:10},conditions:["monsterHealthStatus","monsterExplosionCondition"],type:"monster",rules:["moveToDirection","rotateByPlayer","setDirectionToPlayerAdvance","dynamicZIndex","resetSpeed","resetEffects"]},W={zIndex:1,collisions:!0,sprite:["bigMonsters",[0,0],[32,50],6,[0,1,2]],size:[25,40],render:"unit",parameters:{speed:50,exp:60,cooldown:75,power:10,health:50,effects:[]},conditions:["monsterHealthStatus","stopOnCollisionWithPlayer"],type:"monster",rules:["setDirectionToPlayer","monsterBossLogic","moveToDirection","rotateByDirection","dynamicZIndex","resetSpeed","resetEffects","resetRangeCooldown"]},G={zIndex:1,collisions:!0,sprite:["boss",[0,0],[96,48],6,[0,1,2]],size:[40,45],render:"unit",parameters:{speed:15,cooldown:200,exp:120,fireRange:300,power:10,health:30,effects:[]},conditions:["monsterHealthStatus","stopOnCollisionWithPlayer"],type:"monster",rules:["setDirectionToPlayer","monsterBoss2Logic","rotateByDirection","dynamicZIndex","resetSpeed","resetEffects","resetRangeCooldown"]},K={zIndex:3,render:"object",collisions:!0,size:[25,25],sprite:["pumpkin",[0,0],[32,32],5,[0,1]],conditions:["triggerOnPlayerCollision"],rules:["dynamicZIndex"],parameters:{power:10}},N={zIndex:2,size:[25,25],collisions:!0,sprite:["powerUp",[0,0],[72,65],15,[0,1,2,1]],conditions:["triggerOnPlayerCollisionPowerUp"],parameters:{exp:250}},Z={zIndex:3,collisions:!0,sprite:["darkblast",[0,0],[38,38],12,[0,1,2,3]],type:"monsterSpellElement",render:"object",size:[32,32],conditions:["damageOnPlayerCollision","destroyOnPlayerCollision"],parameters:{power:8,speed:100},rules:["destroyAfterLeavingLayer","moveToDirection","dynamicZIndex"]},F={zIndex:3,collisions:!0,sprite:["bossSpell",[0,0],[30,26],10,[0,1,2]],type:"monsterSpellElement",render:"object",size:[28,24],conditions:["monsterBoss2Bullet"],parameters:{power:15,cooldown:100,speed:200},rules:["destroyAfterLeavingLayer","setDirectionToPlayer","rotateByDirection","moveToDirection","dynamicZIndex"]},H={zIndex:2,sprite:["monsterBlood",[0,0],[32,13]],parameters:{cooldown:500},rules:["removeOnCooldown"]},_={zIndex:2,sprite:["bloodEffect",[0,0],[64,64],15,[0,1,2,3,4],null,!0,.785],rules:["destroyAfterSpriteDone","dynamicZIndex"]},U={render:"object",size:[39,39],sprite:["explosions",[0,0],[39,39],16,[0,1,2,3,4,5,6,7,8,9,10],null,!0],rules:["destroyAfterSpriteDone","dynamicZIndex"]},X={render:"object",collisions:!0,type:"spellEffect",conditions:["monsterExplosion"],size:[39,39],sprite:["explosions",[0,0],[39,39],16,[0,1,2,3,4,5,6,7,8,9,10,11,12],null,!0],rules:["destroyAfterSpriteDone","dynamicZIndex"]},Y={render:"fog",zIndex:2500,type:"effect"},V={sprite:["tree1",[0,0],[62,87]],size:[62,88],rules:["dynamicZIndex"]},q={sprite:["tree2",[0,0],[59,87]],size:[60,88],rules:["dynamicZIndex"]},J={render:"object",sprite:["stone",[0,0],[25,22]],size:[15,22],rules:["dynamicZIndex"]},Q={zIndex:3e3,render:"ui",pos:[400,350],sprite:["cursor",[0,0],[30,30]],rules:["bindPositionToMouse"]},$={zIndex:3e3,pos:[5,13],render:"text",parameters:{weight:"bold",color:"#DAA520",template:"SCORE: {kills}",size:14},rules:["countMonsterKilled"]},ee={zIndex:3e3,pos:[5,100],render:"text",parameters:{weight:"bold",color:"#DAA520",template:"LEFT ON THIS WAVE: {count}",size:14}},te={zIndex:3e3,pos:[35,45],render:"expBar",parameters:{weight:"bold",color:"#EFEFEF",template:"LEVEL: {level}",size:14},rules:["level"]},re={zIndex:3e3,pos:[5,23],render:"text",parameters:{weight:"bold",color:"#DAA520",template:"TIMER: {time}",size:14},rules:["timer"]},se={pos:[5,370],zIndex:3e3,render:"text",parameters:{weight:"bold",color:"#DAA520",size:14,template:"BEST TIME: {time}"},rules:["bestTime"]},ae={pos:[5,380],zIndex:3e3,render:"text",parameters:{weight:"bold",color:"#DAA520",size:14,template:"BEST SCORE: {score}"},rules:["bestScore"]};var oe=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},a),s),o),n),l),i);function ne(e,t,r){if(!e||!t)return null;const s=t.clone().normalize().multiply(r,r);return y.a.Point.add(e,s)}const ie={update:function(e){const t=e.layer.getObjectsByType("player")[0],r=e.parameters.fireCooldown,s=t.parameters.spellPower;function a(r,a){const o=ut.getConfig("bullet");o.pos=t.pos.clone();const n=e.layer.addObject(o);n.parameters.direction=r,n.parameters.power=n.parameters.power+5*(s-1),n.sprite.setDegree(t.pos.angle(a))}if("fireball"==t.parameters.currentSpell&&(e.layer.game.input.mousePointer.isDown||e.layer.game.input.keyboard.isDown(32))&&!r){const r=new y.a.Point(e.layer.game.input.mousePointer.x,e.layer.game.input.mousePointer.y);let o=10*(s-1);r.x-=e.layer.translate.x,r.y-=e.layer.translate.y;for(let e=0;e<s;e++){let e=r.clone().rotate(t.pos.x,t.pos.y,o,!0);a(y.a.Point.subtract(e,t.pos),e.clone()),o-=20}e.parameters.cooldown=e.defaultParameters.cooldown,e.parameters.fireCooldown=e.parameters.cooldown}r&&(e.parameters.fireCooldown=r-1)}},le={update:function(e){const t=e.layer.getObjectsByType("player")[0],r=e.parameters.fireCooldown;function s(r){const s=t.parameters.spellPower,a=ut.getConfig("hellfireTube");a.pos=r;const o=e.layer.addObject(a);o.parameters.power=o.parameters.power+5*(s-1)}if("hellfire"==t.parameters.currentSpell&&(e.layer.game.input.mousePointer.isDown||e.layer.game.input.keyboard.isDown(32))&&!r){const r=new y.a.Point(0,1),a=ne(t.pos,r,100);for(let e=-10;e<10;e++){s(a.clone().rotate(t.pos.x,t.pos.y,18*e,!0))}e.parameters.cooldown=e.defaultParameters.cooldown,e.parameters.fireCooldown=e.parameters.cooldown}r&&(e.parameters.fireCooldown=r-1)}},pe={update:function(e){const t=e.parameters.collisions;for(let r=0;r<t.length;r++)if("monster"==t[r].type){const s=t[r].parameters.speed,a=e.parameters.power,o=t[r].parameters.effects||[];t[r].parameters.speed=s<a?0:s-a,-1==o.indexOf("frozen")&&o.push("frozen")}}},de={update:function(e){const t=e.layer.getObjectsByType("player")[0],r=e.parameters.fireCooldown;if("teleport"==t.parameters.currentSpell&&(e.layer.game.input.mousePointer.isDown||e.layer.game.input.keyboard.isDown(32))&&!r){const r=new y.a.Point(e.layer.game.input.mousePointer.x,e.layer.game.input.mousePointer.y);r.x-=e.layer.translate.x,r.y-=e.layer.translate.y;const s=y.a.Point.subtract(r,t.pos),a=t.parameters.spellPower,o=ne(t.pos,s,e.parameters.power),n=e.defaultParameters.cooldown-30*(a-1);let i;i=ut.getConfig("teleportGate"),i.pos=t.pos.clone(),e.layer.addObject(i),i=ut.getConfig("teleportGate"),i.pos=o.clone(),e.layer.addObject(i),t.setPosition(o),e.parameters.cooldown=n>50?n:50,e.parameters.fireCooldown=e.parameters.cooldown}r&&(e.parameters.fireCooldown=r-1)}},ce={update:function(e){const t=e.layer.getObjectsByType("player")[0],r=e.parameters.fireCooldown;if("frostShard"==t.parameters.currentSpell&&(e.layer.game.input.mousePointer.isDown||e.layer.game.input.keyboard.isDown(32))&&!r){const r=ut.getConfig("frostShard"),s=new y.a.Point(e.layer.game.input.mousePointer.x,e.layer.game.input.mousePointer.y),a=t.parameters.spellPower,o=s.clone();o.x-=e.layer.translate.x,o.y-=e.layer.translate.y,r.pos=o.clone();let n=0;for(let e=1;e<a;e++)n+=50;const i=e.layer.addObject(r);i.parameters.cooldown=i.parameters.cooldown+n,e.parameters.fireCooldown=e.parameters.cooldown}r&&(e.parameters.fireCooldown=r-1)}},me={update:function(e){const t=e.parameters.collisions;for(let r=0,s=t.length;r<s;r++)if("monster"==t[r].type){t[r].parameters.health=t[r].parameters.health-e.parameters.power;const s=ut.getConfig("bloodSpray");s.pos=t[r].pos.clone(),s.pos.x+=2,s.pos.y+=-10,e.layer.addObject(s),e.layer.removeObjectOnNextTick(e.id);break}}},ue={update:function(e){const t=e.parameters.collisions;for(let r=0,s=t.length;r<s;r++)if("monster"==t[r].type){t[r].parameters.health=t[r].parameters.health-e.parameters.power;const s=ut.getConfig("bloodSpray");s.pos=t[r].pos.clone(),s.pos.x+=2,s.pos.y+=-10,e.layer.addObject(s);break}}};var he=r(1),fe=r.n(he);const ye=[10,25,50,75,100,150,200,500,1e3,2500,5e3,1e4],ge={init:function(e){e.parameters.currentWave=1,e.parameters.monsterOnWave=ye[e.parameters.currentWave-1],e.parameters.monsterKilled=0,e.parameters.monsterSpawned=0,this.leftOnWave=e.layer.addObject(ut.getConfig("leftOnWaveLabel"))},update:function(e){e.parameters.monsterSpawned<e.parameters.monsterOnWave&&(e.parameters.currentMonsterCooldown?e.parameters.currentMonsterCooldown&&e.parameters.currentMonsterCooldown--:(!function(){const t=new y.a.Rectangle(100-e.layer.translate.x,100-e.layer.translate.y,800-e.layer.translate.x,550-e.layer.translate.y),r=ut.getConfig("summonGate");r.pos=new y.a.Point(t.randomX,t.randomY),r.pos.x=Math.min(1100,Math.max(50,r.pos.x)),r.pos.y=Math.min(900,Math.max(50,r.pos.y)),e.layer.addObject(r)}(),e.parameters.monsterSpawned=e.parameters.monsterSpawned+1,e.parameters.currentMonsterCooldown=10)),!e.layer.getObjectsByType("monster").length&&e.parameters.monsterKilled<e.parameters.monsterSpawned?e.parameters.monserSpawned=e.parameters.monsterKilled:e.parameters.monsterKilled>=e.parameters.monsterOnWave&&(e.parameters.currentWave=e.parameters.currentWave+1,e.parameters.monsterSpawned=0,e.parameters.monsterOnWave=ye[e.parameters.currentWave-1],e.parameters.monsterKilled=0),this.leftOnWave.parameters.text=fe()(this.leftOnWave.parameters.template,{count:e.parameters.monsterKilled+"/"+e.parameters.monsterOnWave})}},be={update:function(e){e.parameters.health<=0&&e.layer.state.stopBattle()}},we={update:function(e){const t=e.parameters.collisions;for(let r=0;r<t.length;r++)if("player"==t[r].type){t[r].parameters.health=t[r].parameters.health-e.parameters.power;break}}},xe={update:function(e){const t=e.parameters.collisions;for(let r=0;r<t.length;r++)if("player"==t[r].type){const t=ut.getConfig("explosion");t.pos=e.pos.clone(),e.layer.addObject(t),e.layer.removeObjectOnNextTick(e.id);break}}},Oe={update:function(e){const t=e.parameters.collisions;for(let r=0;r<t.length;r++)if("player"==t[r].type){t[r].parameters.health<t[r].defaultParameters.health&&(t[r].parameters.health+e.parameters.power<=t[r].defaultParameters.health?t[r].parameters.health=t[r].parameters.health+e.parameters.power:t[r].parameters.health=t[r].defaultParameters.health),e.layer.removeObjectOnNextTick(e.id);break}}},Ce={update:function(e){if(!e.parameters.meleeCooldown){const t=e.parameters.collisions;for(let r=0;r<t.length;r++)if("player"==t[r].type){t[r].parameters.health=t[r].parameters.health-e.parameters.power;const s=ut.getConfig("bloodSpray");s.pos=t[r].pos.clone(),s.pos.x+=2,s.pos.y+=-10,e.layer.addObject(s),e.parameters.meleeCooldown=e.parameters.cooldown;break}}}},je={update:function(e){if(!e.parameters.exploded){const t=e.parameters.collisions;for(let r=0,s=t.length;r<s;r++)if(t[r].parameters.health){t[r].parameters.health=t[r].parameters.health-e.parameters.power;break}e.parameters.exploded=!0}}},ze={update:function(e){function t(){const t=e.pos.clone();let r;const s=e.parameters.power;let a;e.layer.removeObjectOnNextTick(e.id),r=ut.getConfig("monsterExplosion"),r.pos=new y.a.Point(t.x-e.size[0],t.y-e.size[1]),a=e.layer.addObject(r),a.parameters.power=s,r=ut.getConfig("monsterExplosion"),r.pos=new y.a.Point(t.x+e.size[0],t.y-e.size[1]),a=e.layer.addObject(r),a.parameters.power=s,r=ut.getConfig("monsterExplosion"),r.pos=new y.a.Point(t.x-e.size[0],t.y+e.size[1]),a=e.layer.addObject(r),a.parameters.power=s,r=ut.getConfig("monsterExplosion"),r.pos=new y.a.Point(t.x+e.size[0],t.y+e.size[1]),a=e.layer.addObject(r),a.parameters.power=s,r=ut.getConfig("monsterExplosion"),r.pos=new y.a.Point(t.x-1.5*e.size[0],t.y),a=e.layer.addObject(r),a.parameters.power=s,r=ut.getConfig("monsterExplosion"),r.pos=new y.a.Point(t.x+1.5*e.size[0],t.y),a=e.layer.addObject(r),a.parameters.power=s}if(e.parameters.health<=0)t();else{const r=e.parameters.collisions;for(let e=0;e<r.length;e++)if("player"==r[e].type){t();break}}}},Pe={update:function(e){const t=e.parameters.collisions;for(let r=0,s=t.length;r<s;r++)if("player"==t[r].type){e.parameters.speed=0;break}}},ve={update:function(e){e.parameters.speed=e.defaultParameters.speed}},Te={update:function(e){e.parameters.effects.splice(0)}},Se={update:function(e,t){const r=e.parameters.direction;r&&e.setPosition(ne(e.pos,r,e.parameters.speed*t))}},Ie={update:function(e){const t=e.parameters.levelTable[e.parameters.level];e.parameters.levelTable[e.parameters.level]?e.parameters.exp>e.parameters.levelTable[e.parameters.level]&&(e.parameters.exp=e.parameters.exp-t,e.parameters.level=e.parameters.level+1,e.parameters.spellPower=e.parameters.spellPower+1):e.parameters.level="MAX"}},Be={update:function(e){if(e.parameters.health<=0){e.layer.removeObjectOnNextTick(e.id);const t=ut.getConfig("explosion");t.pos=e.pos.clone(),e.layer.addObject(t);const r=ut.getConfig("blood");r.pos=e.pos.clone(),e.layer.addObject(r),e.layer.state.parameters.monstersKilled||(e.layer.state.parameters.monstersKilled=0);const s=e.layer.getObjectsByType("monsterController")[0];s.parameters.monsterKilled=s.parameters.monsterKilled+1,e.layer.state.parameters.monstersKilled++;const a=e.layer.getObjectsByType("player")[0];a.parameters.exp=a.parameters.exp+e.parameters.exp}}},Me={update:function(e){const t=e.parameters.fireCooldown;t&&(e.parameters.fireCooldown=t-1)}},ke={update:function(e){const t=e.parameters.meleeCooldown;t&&(e.parameters.meleeCooldown=t-1)}},Ee={update:function(e){const t=e.layer.getObjectsByType("player")[0];if(!e.parameters.fireCooldown){var r=ut.getConfig("mbullet");const s=y.a.Point.subtract(t.pos,e.pos);r.pos=e.pos.clone();const a=e.layer.addObject(r);a.parameters.direction=s,a.sprite.setDegree(e.pos.angle(t.pos)),e.parameters.fireCooldown=e.parameters.cooldown}}},De={update:function(e,t){const r=e.layer.getObjectsByType("player")[0],s=e.parameters.direction;if(y.a.Point.distance(e.pos,r.pos)<e.parameters.fireRange){if(!e.parameters.fireCooldown){var a=ut.getConfig("mbullet2");a.pos=e.pos.clone();e.layer.addObject(a).parameters.direction=s,e.parameters.fireCooldown=e.parameters.cooldown}}else e.setPosition(ne(e.pos,s,e.parameters.speed*t))}},Ae={update:function(e){const t=e.parameters.cooldown,r=e.parameters.collisions;if(0==t)return e.layer.removeObjectOnNextTick(e.id),void s();e.parameters.cooldown=t-1;for(let t=0;t<r.length;t++)if("player"==r[t].type){e.layer.removeObjectOnNextTick(e.id),s();break}function s(){const t=e.pos.clone();let r;const s=e.parameters.power;let a;r=ut.getConfig("monsterExplosion"),r.pos=new y.a.Point(t.x,t.y),a=e.layer.addObject(r),a.parameters.power=s}}},Re={update:function(e){const t=e.pos.clone(),r={};r.left=e.layer.game.input.keyboard.isDown(65),r.up=e.layer.game.input.keyboard.isDown(87),r.down=e.layer.game.input.keyboard.isDown(83),r.right=e.layer.game.input.keyboard.isDown(68),r.right&&(t.x=e.pos.x+1),r.left&&(t.x=e.pos.x-1),r.down&&(t.y=e.pos.y+1),r.up&&(t.y=e.pos.y-1),e.pos.x==t.x&&e.pos.y==t.y?e.parameters.direction=null:e.parameters.direction=y.a.Point.subtract(t,e.pos)}},Le={update:function(e){e.layer.game.input.keyboard.isDown(49)&&(e.parameters.currentSpell="fireball"),e.layer.game.input.keyboard.isDown(50)&&(e.parameters.currentSpell="hellfire"),e.layer.game.input.keyboard.isDown(51)&&(e.parameters.currentSpell="frostShard"),e.layer.game.input.keyboard.isDown(52)&&(e.parameters.currentSpell="teleport")}},We={update:function(e){const t=e.parameters.collisions;for(let r=0;r<t.length;r++)if("player"==t[r].type){t[r].parameters.exp=t[r].parameters.exp+e.parameters.exp,e.layer.removeObjectOnNextTick(e.id);break}}},Ge={update:function(e){const t=e.parameters.cooldown;if(0==t){let t=function(){let t,r=100*Math.random();return r<=e.parameters.chanceOfBoss?t=ut.getConfig("monsterBoss"):r-=e.parameters.chanceOfBoss,!t&&r<=e.parameters.chanceOfBoss2?t=ut.getConfig("monsterBoss2"):r-=e.parameters.chanceOfBoss2,!t&&r<=e.parameters.chanceOfBoomer?t=ut.getConfig("monsterBoomer"):r-=e.parameters.monsterBoomer,t||(t=ut.getConfig("monster")),t}(),r=e.layer.getObjectsByType("player")[0];t.pos=e.pos.clone();const s=e.layer.addObject(t);r.parameters.level>1&&(s.parameters.health=.75*s.parameters.health*r.parameters.level),e.layer.removeObjectOnNextTick(e.id)}else e.parameters.cooldown=t-1}},Ke={init:function(e){function t(){return[Math.round(Math.random()*e.size[0]),Math.round(Math.random()*e.size[1])]}for(let r=0;r<100;r++){const r=ut.getConfig("tree"+(Math.round(Math.random())+1)),s=t();r.pos=new y.a.Point(s[0],s[1]),e.addObject(r)}for(let r=0;r<100;r++){const r=ut.getConfig("stones"),s=t();r.pos=new y.a.Point(s[0],s[1]),e.addObject(r)}}},Ne={update:function(e){if(e.parameters.spawnHeartCurrentCooldown)e.parameters.spawnHeartCurrentCooldown--;else{const t=ut.getConfig("heart"),r=new y.a.Rectangle(50,50,1104,868);t.pos=new y.a.Point(r.randomX,r.randomY),e.addObject(t),e.parameters.spawnHeartCurrentCooldown=400}}},Ze={update:function(e){if(e.parameters.spawnPowerupCurrentCooldown)e.parameters.spawnPowerupCurrentCooldown--;else{const t=ut.getConfig("powerup"),r=new y.a.Rectangle(100,100,1e3,750);t.pos=new y.a.Point(r.randomX,r.randomY),e.addObject(t),e.parameters.spawnPowerupCurrentCooldown=400}}},Fe={init:function(e){const t=ut.getConfig("gate");let r;for(let t=0;t<7;t++)r=ut.getConfig("wall"),r.pos=[r.size[0]*t+r.size[0]/2,r.size[1]/2],e.addObject(r);t.pos=[r.pos.x+r.size[0]/2+t.size[0]/2,(t.size[1]-3)/2];e.addObject(t)}},He={update:function(e,t){const r=e.getObjectsByType("player")[0],s=(r.pos.x+e.translate.x)/1024*100,a=(r.pos.y+e.translate.y)/768*100;s<30&&e.translate.x<0&&(e.translate.x+=Math.round(r.parameters.speed*t)),s>70&&e.translate.x>-300&&(e.translate.x-=Math.round(r.parameters.speed*t)),a<25&&e.translate.y<0&&(e.translate.y+=Math.round(r.parameters.speed*t)),a>75&&e.translate.y>-300&&(e.translate.y-=Math.round(r.parameters.speed*t))}},_e={update:function(e){const t=e.parameters.template;e.parameters.text=fe()(t,{kills:e.layer.state.parameters.monstersKilled||0})}},Ue={update:function(e){const t=e.parameters.template;e.parameters.text=fe()(t,{time:(e.layer.state.parameters.gameTimer++/60).toFixed(2)})}},Xe={update:function(e){const t=e.parameters.template;e.parameters.text=fe()(t,{health:e.layer.getObjectsByType("player")[0].parameters.health})}},Ye={update:function(e){const t=e.parameters.template,r=e.layer.getObjectsByType("player")[0];e.parameters.text=fe()(t,{level:r.parameters.level,exp:r.parameters.exp,levelExp:r.parameters.levelTable[r.parameters.level]})}},Ve={init:function(e){const t=e.parameters.template;e.parameters.text=fe()(t,{time:(e.layer.state.parameters.bestTime/60).toFixed(2)})}},qe={init:function(e){const t=e.parameters.template;e.parameters.text=fe()(t,{score:e.layer.state.parameters.bestScore})}},Je={update:function(e){e.pos.x-e.sprite.size[0]/2<0?e.pos.x=e.sprite.size[0]/2:e.pos.x+e.sprite.size[0]/2>e.layer.size[0]&&(e.pos.x=e.layer.size[0]-e.sprite.size[0]/2),e.pos.y-e.sprite.size[1]/2<0?e.pos.y=e.sprite.size[1]/2:e.pos.y+e.sprite.size[1]/2>e.layer.size[1]&&(e.pos.y=e.layer.size[1]-e.sprite.size[1]/2)}},Qe={update:function(e){if(e.pos.y<-100||e.pos.y-e.sprite.size[1]-100>e.layer.size[1]||e.pos.x-e.sprite.size[0]-100>e.layer.size[0]||e.pos.x<-100)return e.layer.removeObjectOnNextTick(e.id),!1}},$e={update:function(e){const t=e.layer.getObjectsByType("player")[0];e.parameters.direction=y.a.Point.subtract(t.pos,e.pos)}},et={update:function(e){const t=e.layer.getObjectsByType("player")[0],r=t.parameters.direction;let s=e.parameters.direction;if(s||(s=y.a.Point.subtract(t.pos,e.pos)),null==r)e.parameters.direction=y.a.Point.subtract(t.pos,e.pos);else{let a=Math.abs(Math.min(t.parameters.speed,y.a.Point.distance(e.pos,t.pos))-10),o=ne(t.pos,r,a),n=y.a.Point.subtract(o,e.pos).normalize(),i=s.clone().normalize(),l=y.a.Point.add(i,n).normalize();e.parameters.direction=l}}},tt={init:function(e){const t=new y.a.Rectangle(100,100,1e3,750);e.parameters.direction=new y.a.Point(t.randomX,t.randomY)},update:function(e){const t=e.layer.getObjectsByType("player")[0];if(y.a.Point.distance(e.pos,t.pos)<=e.parameters.scentRange)e.parameters.scent=!0,e.parameters.speed=e.defaultParameters.scentSpeed,e.parameters.wanderCooldown=0,e.parameters.direction=y.a.Point.subtract(t.pos,e.pos);else if(e.parameters.speed=e.defaultParameters.speed,e.parameters.wanderCooldown)e.parameters.wanderCooldown&&(e.parameters.wanderCooldown=e.parameters.wanderCooldown-1);else{const t=new y.a.Rectangle(100,100,1e3,750);e.parameters.direction=y.a.Point.subtract(new y.a.Point(t.randomX,t.randomY),e.pos),e.parameters.wanderCooldown=Math.round(Math.random()*(e.defaultParameters.wanderCooldown-100)+100)}}},rt={update:function(e){let t=0;e.pos&&(t+=e.pos.y),e.sprite&&(t+=e.sprite.size[1]/2),e.zIndex=e.pos.y>0?Math.round(t):0}},st={init:function(e){const t=[];e.parameters.collisions=t,t.cells=[],e.layer.state.collisions.updateObject(e)},update:function(e){e.parameters.collisions.splice(0),e.layer.state.collisions.updateObject(e)}},at={update:function(e){const t=new y.a.Point(e.layer.game.input.mousePointer.x,e.layer.game.input.mousePointer.y);t.x-=e.layer.translate.x,t.y-=e.layer.translate.y;const r=y.a.Point.subtract(t,e.pos);e.sprite.rotateToDirection(r)}},ot={update:function(e){const t=new y.a.Point(e.layer.game.input.mousePointer.x,e.layer.game.input.mousePointer.y);e.setPosition(t.clone())}},nt={update:function(e){const t=e.parameters.cooldown;0==t?e.layer.removeObjectOnNextTick(e.id):e.parameters.cooldown=t-1}},it={update:function(e){const t=e.parameters.cooldown;if(0==t){e.layer.removeObjectOnNextTick(e.id);const t=ut.getConfig("monsterExplosion");t.pos=new y.a.Point(e.pos.x,e.pos.y);e.layer.addObject(t).parameters.power=e.parameters.power}else e.parameters.cooldown=t-1}},lt={update:function(e){if(e.sprite.done){e.layer.removeObjectOnNextTick(e.id);const t=ut.getConfig("monsterExplosion");t.pos=new y.a.Point(e.pos.x,e.pos.y);e.layer.addObject(t).parameters.power=e.parameters.power}}},pt={update:function(e){e.sprite.done&&e.layer.removeObjectOnNextTick(e.id)}},dt={update:function(e){e.sprite.rotateToDirection(e.parameters.direction)}},ct={update:function(e){const t=e.layer.getObjectsByType("player")[0];e.sprite.rotateToDirection(y.a.Point.subtract(t.pos,e.pos))}};var mt=Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},d),p),c),m),u),h);var ut={getRuleConfig:function(e){return mt[e]},getConfig:function(e){const t=JSON.parse(JSON.stringify(oe[e]));return!t.id&&(t.id=e),t}};class ht{constructor(e){this._update=e.update,this._init=e.init,this.inited=!1}init(e){this.inited||(this._init&&this._init(e),this.inited=!0)}update(e,t){this._update&&this._update(e,t)}}class ft{constructor({cache:e,pos:t,size:r,speed:s,frames:a,url:o,dir:n,once:i,degree:l}){this.cache=e,this.pos=t,this.defaultPosition=this.pos.clone(),this.size=r,this.speed="number"==typeof s?s:0,this.frames=a,this.frameIndex=0,this.url=o,this.dir=n||"horizontal",this.once=i,this.degree=l||0}update(e){this.frameIndex+=this.speed*e}setDegree(e){this.degree=e}rotateToDirection(e){const t=e.angle(new y.a.Point(0,0),!0),{x:r,y:s}=this.defaultPosition;t>135||t<-135?this.pos.setTo(r,s+2*this.size[1]):t<135&&t>45?this.pos.setTo(r,s+3*this.size[1]):t<45&&t>-45?this.pos.setTo(r,s+this.size[1]):this.pos.setTo(r,s)}render(e){let t,r=this.pos.x,s=this.pos.y;if(this.speed>0){const e=this.frames.length,r=Math.floor(this.frameIndex);if(t=this.frames[r%e],this.once&&r>=e)return void(this.done=!0)}else t=0;"vertical"===this.dir?s+=t*this.size[1]:r+=t*this.size[0],e.rotate(this.degree),e.drawImage(this.cache.getImage(this.url),r,s,this.size[0],this.size[1],Math.round(-this.size[0]/2),Math.round(-this.size[1]/2),this.size[0],this.size[1])}}function yt(e){const t=e.layer.ctx,r=Math.round(-e.sprite.size[0]/2),s=Math.round(-e.sprite.size[1]/2-7),a=e.sprite.size[0];t.globalAlpha=.5,e.parameters.health>0&&e.defaultParameters.health>e.parameters.health&&(t.fillStyle="rgb(250, 0, 0)",t.fillRect(r,s,a,3),t.fillStyle="rgb(0, 250, 0)",t.fillRect(r,s,Math.round(a*(e.parameters.health/e.defaultParameters.health)),3)),t.globalAlpha=1}function gt(e,t){const r=e.layer.ctx;r.globalAlpha=1,e.sprite.update(t),e.sprite.render(r)}function bt(e){if(e.size){const p=e.layer.ctx;p.globalAlpha=.5,p.beginPath(),t=p,r=0,s=+e.sprite.size[1]/2-3,a=Math.min(e.sprite.size[0],e.size[0])/2+8,o=5,n=0,i=0,l=2*Math.PI,t.save(),t.translate(r,s),t.rotate(n),t.translate(-a,-o),t.scale(a,o),t.arc(1,1,1,i,l,!1),t.restore(),p.fillStyle="black",p.fill(),p.globalAlpha=1}var t,r,s,a,o,n,i,l}function wt(e){const t=e.layer.ctx,r=e.parameters.effects;for(let s=0;s<r.length;s++){"frozen"===r[s]&&(t.globalAlpha=.8,t.drawImage(e.layer.game.cache.getImage("frostEffect"),-16,+e.sprite.size[1]/2-32,32,32),t.globalAlpha=1)}}function xt(e){const t=e.layer.ctx;let r="";t.translate(-e.layer.translate.x,-e.layer.translate.y),e.parameters.style&&(r+=e.parameters.style+" "),e.parameters.weight&&(r+=e.parameters.weight+" "),r+=(e.parameters.size||30)+"pt ",r+=e.parameters.font||"Arial",e.parameters.align&&(t.textAlign=e.parameters.align),t.font=r,t.fillStyle=e.parameters.color||"#FFF",t.fillText(e.parameters.text,e.pos.x,e.pos.y),t.translate(e.layer.translate.x,e.layer.translate.y)}var Ot={shadow:bt,fog:function(e){const t=e.layer.ctx,r=e.layer.getObjectsByType("player")[0].pos.x,s=e.layer.getObjectsByType("player")[0].pos.y,a=e.layer.ctx.createRadialGradient(r,s,0,r,s,700);a.addColorStop(0,"rgba(0, 0, 0, 0)"),a.addColorStop(1,"rgba(0, 0, 0, 0.97)"),t.fillStyle=a,t.beginPath(),t.arc(r,s,2e3,0,2*Math.PI,!1),t.closePath(),t.fill()},expBar:function(e){const t=e.layer.ctx,r=e.layer.getObjectsByType("player")[0];t.translate(-e.layer.translate.x,-e.layer.translate.y),t.globalAlpha=.3,t.fillStyle="rgb(220, 220, 220)",t.fillRect(-22,17,200,40),t.globalAlpha=1,t.fillStyle="#DAA520",r.parameters.levelTable[r.parameters.level]?t.fillRect(-22,17,Math.min(200,Math.round(r.parameters.exp/r.parameters.levelTable[r.parameters.level]*200)),40):t.fillRect(-22,17,200,40),t.translate(e.layer.translate.x,e.layer.translate.y),xt(e)},healthBar:yt,sprite:gt,effects:wt,ui:function(e,t){const r=e.layer.ctx;r.translate(-e.layer.translate.x,-e.layer.translate.y),gt(e,t),r.translate(e.layer.translate.x,e.layer.translate.y)},object:function(e,t){bt(e),gt(e,t)},text:xt,spell:function(e,t){const r=e.layer.ctx,s=Math.round(-e.sprite.size[0]/2-4),a=Math.round(-e.sprite.size[1]/2-4),o=e.sprite.size[0]+8,n=e.sprite.size[1]+8;r.translate(-e.layer.translate.x,-e.layer.translate.y),-1!==e.id.indexOf(e.layer.getObjectsByType("player")[0].parameters.currentSpell)&&(r.fillStyle="rgb(0, 250, 0)",r.fillRect(s-2,a-2,o+4,n+4)),r.globalAlpha=.4,r.fillStyle="rgb(0, 0, 0)",r.fillRect(s,a,o,n),r.fillStyle="rgb(0, 0, 0)",r.fillRect(s,a,o,n),r.globalAlpha=1,gt(e,t),e.parameters.fireCooldown>0&&(r.globalAlpha=.8,r.fillStyle="rgb(20, 20, 20)",r.fillRect(s,Math.round(a+n-n*(e.parameters.fireCooldown/e.parameters.cooldown)),o,n),r.globalAlpha=1),r.translate(e.layer.translate.x,e.layer.translate.y)},unit:function(e,t){bt(e),yt(e),gt(e,t),wt(e)}};class Ct{constructor(e){this.layer=e.layer,e.pos instanceof Phaser.Point?this.pos=e.pos.clone():e.pos?this.pos=new Phaser.Point(e.pos[0],e.pos[1]):this.pos=new Phaser.Point,this.id=e.id,e.sprite&&(this.sprite=new ft({cache:this.layer.game.cache,url:e.sprite[0],pos:new Phaser.Point(...e.sprite[1]),size:e.sprite[2],speed:e.sprite[3],frames:e.sprite[4],dir:e.sprite[5],once:e.sprite[6],degree:e.sprite[7]})),this.type=e.type||"default",(e.size||this.sprite)&&(this.size=e.size||this.sprite.size),this.shouldCheckCollisions=e.collisions,this.zIndex=e.zIndex||0,this.parameters=e.parameters&&z(e.parameters)||{},this.defaultParameters=z(this.parameters),this.size=e.size,this.rules=e.rules||[],this.conditions=e.conditions||[],e.render?Ot[e.render]?this.customRender=Ot[e.render]:this.customRender=e.render:!1===e.render&&(this.noRender=!0),this.inited=!1}render(e){this.noRender||(this.customRender?Array.isArray(this.customRender)?this.customRender.forEach(t=>t(this,e)):this.customRender(this,e):Ot.sprite(this,e))}init(){if(!this.inited){const e=this.rules,t=this.conditions;this.rules=[],this.conditions=[],this.shouldCheckCollisions&&(this.collisions=new ht(ut.getRuleConfig("collisions")),this.collisions.init(this));for(let t=0,r=e.length;t<r;t++)this.addRule(ut.getRuleConfig(e[t]));for(let e=0,r=t.length;e<r;e++)this.addCondition(ut.getRuleConfig(t[e]));this.inited=!0}}update(e){this.rules.forEach(t=>t.update(this,e))}updateConditions(e){this.conditions.forEach(t=>t.update(this,e))}updateCollisions(e){this.collisions&&this.collisions.update(this,e)}setPosition(e){this.pos.x=e.x,this.pos.y=e.y}addRule(e){const t=new ht(e);t.init(this),this.rules.push(t)}addCondition(e){const t=new ht(e);t.init(this),this.conditions.push(t)}}class jt{constructor(e){this.objectsToBeRemoved=[],this.config=e,this.id=e.id,this.state=e.state,this.game=this.state.game,this.ctx=e.ctx,this.initList=e.initList,this.background=this.ctx.createPattern(this.game.cache.getImage(e.background),"repeat"),this.size=e.size||[this.ctx.canvas.width,this.ctx.canvas.height],this.sortedObjects={default:[]},this.objects={},this.inited=!1,this.parameters={}}init(){this.inited||(this.translate=this.config.translate?z(this.config.translate):{x:0,y:0},this.config.initList.forEach(e=>this.addObject(ut.getConfig(e))),this.config.init&&this.config.init(),this.rules=[],this.config.rules.forEach(e=>this.addRule(ut.getRuleConfig(e))),this.inited=!0)}render(e){if(!this.inited)return;const t={},r=this.ctx;r.save(),r.beginPath(),r.rect(0,0,this.size[0],this.size[1]),r.clip(),r.translate(this.translate.x,this.translate.y),r.fillStyle=this.background,r.fillRect(0,0,this.size[0]+5,this.size[1]+5);for(let e in this.objects)this.objects.hasOwnProperty(e)&&(t[this.objects[e].zIndex]||(t[this.objects[e].zIndex]=[]),t[this.objects[e].zIndex].push(this.objects[e]));for(let s in t)if(t[s])for(let a=0,o=t[s].length;a<o;a++)r.save(),r.translate(Math.round(t[s][a].pos.x),Math.round(t[s][a].pos.y)),t[s][a].render(e),r.restore();r.translate(-this.translate.x,-this.translate.y),r.restore()}update(e){if(this.inited){for(let t in this.rules)this.rules.hasOwnProperty(t)&&this.rules[t].update(this,e);for(let t in this.objects)this.objects[t].update(e);for(let t in this.objects)this.objects[t].updateCollisions(e);this.state.collisions.check();for(let t in this.objects)this.objects[t].updateConditions(e);for(;this.objectsToBeRemoved.length;){const e=this.objectsToBeRemoved.pop(),t=this.objects[e];t&&(t.shouldCheckCollisions&&this.state.collisions.removeObject(t),this.removeObject(e))}}}removeObjectOnNextTick(e){this.objectsToBeRemoved.push(e)}addRule(e){const t=new ht(e);t.init(this),this.rules.push(t)}removeObject(e){this.objects.hasOwnProperty(e)&&(this.objects[e].layer=null,this.sortedObjects[this.objects[e].type].splice(this.sortedObjects[this.objects[e].type].indexOf(e),1),this.objects[e]=null,delete this.objects[e])}addObject(e){e.layer=this,e.id+=Math.round((new Date).getTime()+1000001*Math.random());const t=new Ct(e);return t.init(),e.type&&"default"!==e.type?(!this.sortedObjects[e.type]&&(this.sortedObjects[e.type]=[]),this.sortedObjects[e.type].push(t.id)):this.sortedObjects.default.push(t.id),this.objects[t.id]=t,this.objects[t.id]}getObjectsByType(e){const t=this.sortedObjects[e]||[],r=[];for(let e=0,s=t.length;e<s;e++)r.push(this.objects[t[e]]);return r}clearLayer(){this.objects={},this.sortedObjects={default:[]},this.rules=[],this.inited=!1}}const zt={id:"mainLayer",size:[1324,1068],background:"terrain",initList:["player","cursor","counter","timer","bestTime","fireballSpell","hellfireSpell","frostShardSpell","teleportSpell","bestScore","level","fog","monsterController"],translate:{x:-150,y:-150},rules:["randomTrees","spawnHeart","spawnPowerup","goWithPlayer"]};class Pt extends y.a.State{init(){this.battleTheme=this.sound.add("battleTheme",.3,!0),this.deathTheme=this.sound.add("deathTheme",.3,!0)}create(){this.pauseFlag=!1,this.collisions=j({n:6,width:1500,height:1200}),this.initGameParameters(),this.initGameLayer(),this.initControls(),this.battleTheme.play()}initControls(){this.restartButton=this.add.button(512,384,"button",this.restart,this,2,0,1,2),this.restartButton.addChild(this.add.text(-65,-15,"RESTART",{fill:"#efefef"})),this.restartButton.addChild(this.add.text(-70,-70,"YOU DIED!",{fill:"#EF0000"})),this.restartButton.anchor.setTo(.5,.5),this.restartButton.kill()}initGameParameters(){this.parameters={monstersKilled:0,gameTimer:0,bestTime:parseInt(localStorage.getItem("bestTime"))||0,bestScore:parseInt(localStorage.getItem("bestScore"))||0}}initGameLayer(){this.bitmap=this.add.bitmapData(this.game.canvas.width,this.game.canvas.height,"battleBitmap"),this.add.image(0,0,this.bitmap),this.gameLayer=new jt(Object.assign(Object.assign({},zt),{init:function(){this.state.parameters.monstersKilled=0,this.state.parameters.gameTimer=0},state:this,ctx:this.bitmap.ctx})),this.gameLayer.init()}stopBattle(){this.updateBestScores(),this.battleTheme.stop(),this.deathTheme.play(),this.restartButton.revive(),this.pauseFlag=!0}updateBestScores(){this.parameters.gameTimer>this.parameters.bestTime&&(this.parameters.bestTime=this.parameters.gameTimer,localStorage.setItem("bestTime",this.parameters.bestTime.toString())),this.parameters.monstersKilled>this.parameters.bestScore&&(this.parameters.bestScore=this.parameters.monstersKilled,localStorage.setItem("bestScore",this.parameters.bestScore.toString()))}prepareForRender(){!0===this.pauseFlag?(this.gameLayer.render(0),this.bitmap.rect(0,0,this.game.canvas.width,this.game.canvas.height,"rgba(10,0,0,0.5)")):(this.gameLayer.update(this.game.time.physicsElapsed),this.gameLayer.render(this.game.time.physicsElapsed))}restart(){this.pauseFlag=!1,this.battleTheme.play(),this.deathTheme.stop(),this.collisions.clear(),this.restartButton.kill(),this.gameLayer.clearLayer(),this.gameLayer.init()}update(){this.prepareForRender()}}var vt={preLoading:b,loading:x,mainMenu:C,battle:Pt};const Tt=new y.a.Game(1024,768,y.a.CANVAS,"main",null,!1,!1);window.game=Tt,Tt.state.add("preloading",vt.preLoading,!0),Tt.state.add("loading",vt.loading),Tt.state.add("battle",vt.battle),Tt.state.add("mainMenu",vt.mainMenu)}])}));